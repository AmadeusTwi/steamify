import Link from "next/link";

import { CreatePost } from "~/app/_components/create-post";
import { getServerAuthSession } from "~/server/auth";
import { api } from "~/trpc/server";

export default async function Home() {
  const hello = await api.post.hello.query({ text: "from tRPC" });
  const session = await getServerAuthSession();

  return (
    <main className="bg-gradient-store-background flex min-h-screen flex-col items-center justify-center text-white">
      <div className="container flex flex-col items-center justify-center gap-12 px-4 py-16">
        <div className="flex">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="300"
            height="75"
            viewBox="0 0 88 21"
            fill="none"
          >
            <path
              d="M10.4581 0C4.9453 0 0.429149 4.25069 0 9.65266L5.62473 11.9782C6.10132 11.6523 6.67708 11.4613 7.29649 11.4613C7.352 11.4613 7.40727 11.4632 7.46207 11.4663L9.96343 7.84069C9.96343 7.82337 9.96319 7.80653 9.96319 7.78945C9.96319 5.60717 11.7384 3.83174 13.9209 3.83174C16.1032 3.83174 17.8784 5.60717 17.8784 7.78945C17.8784 9.97173 16.1032 11.7474 13.9209 11.7474C13.8908 11.7474 13.8609 11.7467 13.831 11.746L10.2635 14.2915C10.2654 14.3377 10.2671 14.3849 10.2671 14.4319C10.2671 16.0702 8.93456 17.4025 7.29649 17.4025C5.85863 17.4025 4.65635 16.3762 4.38401 15.0171L0.361539 13.3542C1.607 17.759 5.65391 20.9885 10.4581 20.9885C16.2541 20.9885 20.9524 16.2899 20.9524 10.4946C20.9524 4.69834 16.2538 0 10.4581 0Z"
              fill="#F3F3F3"
            />
            <path
              d="M6.57622 15.9234L5.28711 15.3909C5.51556 15.8665 5.91079 16.2648 6.43554 16.4835C7.56997 16.9561 8.87782 16.4178 9.35062 15.2825C9.57955 14.7335 9.58097 14.1274 9.35394 13.577C9.12739 13.0264 8.6999 12.597 8.15024 12.3678C7.60485 12.1408 7.02055 12.1491 6.50718 12.3429L7.83876 12.8935C8.67547 13.2423 9.07117 14.2031 8.72244 15.0398C8.37442 15.8767 7.41293 16.2724 6.57622 15.9234Z"
              fill="#F3F3F3"
            />
            <path
              d="M16.5578 7.78939C16.5578 6.33541 15.375 5.15234 13.9207 5.15234C12.4668 5.15234 11.2837 6.33541 11.2837 7.78939C11.2837 9.24361 12.4668 10.4262 13.9207 10.4262C15.375 10.426 16.5578 9.24338 16.5578 7.78939ZM11.9441 7.78489C11.9441 6.69078 12.8311 5.80401 13.9252 5.80401C15.0194 5.80401 15.9064 6.69078 15.9064 7.78489C15.9064 8.87899 15.0194 9.76576 13.9252 9.76576C12.8311 9.76576 11.9441 8.87875 11.9441 7.78489Z"
              fill="#F3F3F3"
            />
            <path
              d="M37.2703 6.28686L36.318 7.9608C35.5844 7.44834 34.5904 7.13989 33.7225 7.13989C32.7307 7.13989 32.117 7.55051 32.117 8.28595C32.117 9.17947 33.2072 9.38734 34.8275 9.96888C36.5692 10.5848 37.5704 11.3087 37.5704 12.9039C37.5704 15.0864 35.854 16.3122 33.3871 16.3122C32.1848 16.3122 30.7345 16.0018 29.6196 15.3236L30.3143 13.4678C31.22 13.9462 32.3034 14.2299 33.2692 14.2299C34.5711 14.2299 35.1899 13.7495 35.1899 13.0395C35.1899 12.2269 34.2463 11.9828 32.723 11.4783C30.9871 10.8987 29.7841 10.1382 29.7841 8.3727C29.7841 6.38164 31.3787 5.23816 33.6731 5.23816C35.2721 5.23816 36.5573 5.74484 37.2703 6.28686Z"
              fill="#F3F3F3"
            />
            <path
              d="M44.7143 7.16142V15.9453H42.472V7.16142H39.2173V5.23816H47.9594V7.16142H44.7143Z"
              fill="#F3F3F3"
            />
            <path
              d="M52.6865 7.15564V9.56823H56.9777V11.4915H52.6865V14.0043H57.6652V15.9453H50.4448V5.23816H57.6652V7.15564H52.6865Z"
              fill="#F3F3F3"
            />
            <path
              d="M62.6697 13.8662L61.9609 15.9453H59.6104L63.6249 5.23816H65.882L70.01 15.9449H67.58L66.8558 13.8659L62.6697 13.8662ZM64.7408 7.79212L63.2786 12.0791H66.2332L64.7408 7.79212Z"
              fill="#F3F3F3"
            />
            <path
              d="M81.5178 9.37674L78.5876 15.6333H77.3223L74.4397 9.43264V15.9453H72.2925V5.23816H74.4349L78.0334 12.9672L81.504 5.23816H83.665V15.9453H81.5181L81.5178 9.37674Z"
              fill="#F3F3F3"
            />
            <path
              d="M87.9999 5.98347C87.9999 6.90366 87.3104 7.47717 86.519 7.47717C85.7248 7.47717 85.0337 6.90366 85.0337 5.98347C85.0337 5.06361 85.7248 4.49396 86.519 4.49396C87.3107 4.49396 87.9999 5.06361 87.9999 5.98347ZM85.2827 5.98347C85.2827 6.75329 85.8373 7.23684 86.519 7.23684C87.1983 7.23684 87.7505 6.75329 87.7505 5.98347C87.7505 5.21141 87.1983 4.73525 86.519 4.73525C85.8392 4.73525 85.2827 5.21719 85.2827 5.98347ZM86.5396 5.22233C86.9235 5.22233 87.0527 5.42539 87.0527 5.64483C87.0527 5.84596 86.9335 5.9809 86.7883 6.04966L87.1324 6.6945H86.8506L86.5605 6.12292H86.2614V6.6945H86.0268V5.22233H86.5396ZM86.2636 5.90733H86.5251C86.6945 5.90733 86.7944 5.80098 86.7944 5.66732C86.7944 5.53238 86.7227 5.44563 86.5245 5.44563H86.2633V5.90733H86.2636Z"
              fill="#F3F3F3"
            />
          </svg>
          <span className="text-store-lightest-grey text-[3.19rem] font-extrabold tracking-tight">
            ify
          </span>
        </div>
        <div className="flex flex-col items-center gap-2">
          <p className="text-2xl text-white">
            {hello ? hello.greeting : "Loading tRPC query..."}
          </p>

          <div className="flex flex-col items-center justify-center gap-4">
            <p className="text-center text-2xl text-white">
              {session && <span>Logged in as {session.user?.name}</span>}
            </p>
            <Link
              href={session ? "/api/auth/signout" : "/api/auth/signin"}
              className="rounded-full bg-white/10 px-10 py-3 font-semibold no-underline transition hover:bg-white/20"
            >
              {session ? "Sign out" : "Sign in"}
            </Link>
          </div>
        </div>

        <CrudShowcase />
      </div>
    </main>
  );
}

async function CrudShowcase() {
  const session = await getServerAuthSession();
  if (!session?.user) return null;

  const latestPost = await api.post.getLatest.query();

  return (
    <div className="w-full max-w-xs">
      {latestPost ? (
        <p className="truncate">Your most recent post: {latestPost.name}</p>
      ) : (
        <p>You have no posts yet.</p>
      )}

      <CreatePost />
    </div>
  );
}
